{"ast":null,"code":"import _asyncToGenerator from \"E:/david/Freelance/Tindux/Transmilenio/rrhh_Api/Spa/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport { Validators } from '@angular/forms';\nimport Swal from 'sweetalert2';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/forms\";\nimport * as i2 from \"@ng-bootstrap/ng-bootstrap\";\nimport * as i3 from \"@angular/router\";\nimport * as i4 from \"src/app/_services/UserLogin/loginTiidux.service\";\nimport * as i5 from \"../../utils/navigation/navigation.component\";\nimport * as i6 from \"@angular/common\";\nimport * as i7 from \"@angular/material/paginator\";\n\nfunction PermisosComponent_option_14_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"option\", 8);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const item_r3 = ctx.$implicit;\n    i0.ɵɵproperty(\"value\", item_r3.rolId);\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate(item_r3.nombre);\n  }\n}\n\nfunction PermisosComponent_div_18_tr_10_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r8 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"tr\");\n    i0.ɵɵelementStart(1, \"td\");\n    i0.ɵɵelementStart(2, \"input\", 11);\n    i0.ɵɵlistener(\"change\", function PermisosComponent_div_18_tr_10_Template_input_change_2_listener() {\n      const restoredCtx = i0.ɵɵrestoreView(_r8);\n      const item_r5 = restoredCtx.$implicit;\n      const ctx_r7 = i0.ɵɵnextContext(2);\n      return ctx_r7.onChange(item_r5);\n    });\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"td\", 12);\n    i0.ɵɵtext(4);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(5, \"td\", 12);\n    i0.ɵɵtext(6);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const item_r5 = ctx.$implicit;\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"checked\", item_r5.check);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(item_r5.Nombre);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(item_r5.descripcion);\n  }\n}\n\nfunction PermisosComponent_div_18_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r10 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"div\", 0);\n    i0.ɵɵelementStart(1, \"table\");\n    i0.ɵɵelementStart(2, \"thead\");\n    i0.ɵɵelementStart(3, \"tr\");\n    i0.ɵɵelement(4, \"th\");\n    i0.ɵɵelementStart(5, \"th\");\n    i0.ɵɵtext(6, \"Nombre\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(7, \"th\");\n    i0.ɵɵtext(8, \"Descripci\\u00F3n\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(9, \"tbody\");\n    i0.ɵɵtemplate(10, PermisosComponent_div_18_tr_10_Template, 7, 3, \"tr\", 9);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelement(11, \"br\");\n    i0.ɵɵelement(12, \"br\");\n    i0.ɵɵelementStart(13, \"mat-paginator\", 10);\n    i0.ɵɵlistener(\"page\", function PermisosComponent_div_18_Template_mat_paginator_page_13_listener($event) {\n      i0.ɵɵrestoreView(_r10);\n      const ctx_r9 = i0.ɵɵnextContext();\n      return ctx_r9.pageEvent($event);\n    });\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const ctx_r1 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(10);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r1.rolPermisosTable);\n    i0.ɵɵadvance(3);\n    i0.ɵɵproperty(\"length\", ctx_r1.Permisos.length)(\"pageSize\", ctx_r1.p_Size)(\"pageSizeOptions\", ctx_r1.optionsPage);\n  }\n}\n\nfunction PermisosComponent_div_19_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 13);\n    i0.ɵɵelement(1, \"img\", 14);\n    i0.ɵɵelementEnd();\n  }\n}\n\nexport let PermisosComponent = /*#__PURE__*/(() => {\n  class PermisosComponent {\n    constructor(fb, modalService, router, loginServices) {\n      this.fb = fb;\n      this.modalService = modalService;\n      this.router = router;\n      this.loginServices = loginServices;\n      this.Permisos = [];\n      this.rolesPermisos = [];\n      this.roles = [];\n      this.rolPermisosTable = [];\n      this.rolPermisoTable = {\n        rolpermisoId: 0,\n        check: false,\n        rolid: 0,\n        permisoid: 0,\n        Nombre: \"\",\n        descripcion: \"\"\n      };\n      this.empresa = [];\n      this.canva = false;\n      this.p_Size = 10;\n      this.page = 1;\n      this.optionsPage = [5, 10, 30, 50];\n      this.empresaToEdit = false;\n      this.rolSeleccionado = false;\n      this.PermisosForm = this.fb.group({\n        rolPermisoId: [0, []],\n        rolId: [0, Validators.required],\n        permisoId: [0, Validators.required]\n      });\n      this.idrol = 0;\n    }\n\n    ngOnInit() {\n      this.cargarLista();\n    }\n\n    onChange(event) {\n      var _a; //debugger;\n\n\n      this.idrol = (_a = this.PermisosForm.get('rolId')) === null || _a === void 0 ? void 0 : _a.value;\n\n      if (event.check && event.rolpermisoId > 0) {\n        this.eliminarRolPermisos(event.rolpermisoId, event.rolid);\n        this.rolSelect(0);\n      } else {\n        var rolesPermisos = {\n          rolpermisoid: 0,\n          rolid: Number(event.rolid),\n          permisoid: Number(event.permisoid)\n        };\n        this.CrearUsuarios(rolesPermisos);\n        this.rolSelect(0);\n      }\n    }\n\n    eliminarRolPermisos(rolpermisoId, rolid) {\n      this.loginServices.eliminarDato('rolesPermisos', rolpermisoId).subscribe(respuesta => {\n        this.cargarRolesPermisos();\n        Swal.fire({\n          icon: respuesta.estado.codigo == \"500\" ? 'warning' : 'success',\n          title: respuesta.estado.codigo == \"500\" ? \"Error eliminando permisos\" : respuesta.estado.descripcion,\n          text: 'Codigo: ' + respuesta.estado.codigo\n        }).then(res => {\n          this.rolSelect(rolid);\n        });\n      }, error => {\n        Swal.fire({\n          icon: 'error',\n          title: 'Error',\n          text: 'Hubo un problema al realizar la solicitud. Por favor, inténtalo nuevamente.'\n        });\n      });\n    }\n\n    CrearUsuarios(body) {\n      //this.canva = true\n      this.loginServices.createData('rolesPermisos', body).subscribe(respuesta => {\n        this.cargarRolesPermisos();\n        Swal.fire({\n          icon: 'success',\n          title: 'Mensaje: ' + respuesta.estado.descripcion,\n          text: 'Codigo: ' + respuesta.estado.codigo\n        }).then(res => {\n          this.rolSelect(body.rolid);\n        });\n      }, error => {\n        Swal.fire({\n          icon: 'error',\n          title: 'Error',\n          text: 'Hubo un problema al realizar la solicitud. Por favor, inténtalo nuevamente.'\n        }); // this.LimpiarFormulario();\n      });\n    }\n\n    pageEvent(e) {\n      this.p_Size = e.pageSize;\n      this.page = e.pageIndex + 1;\n    }\n\n    rolSelect(event) {\n      var _this = this;\n\n      return _asyncToGenerator(function* () {\n        var _a, _b;\n\n        _this.idrol = (_a = _this.PermisosForm.get('rolId')) === null || _a === void 0 ? void 0 : _a.value;\n        _this.rolPermisosTable = [];\n        const selectedValue = (_b = event === null || event === void 0 ? void 0 : event.target) === null || _b === void 0 ? void 0 : _b.value;\n        _this.rolSeleccionado = true;\n\n        let premisosRol = _this.rolesPermisos.filter(x => x.rolID == _this.idrol);\n\n        for (let i = 0; i < _this.Permisos.length; i++) {\n          //debugger;\n          let check = false;\n          let rolPermisoId;\n\n          for (let x = 0; x < premisosRol.length; x++) {\n            if (_this.Permisos[i].permisoId == premisosRol[x].permisoID) {\n              check = true;\n              rolPermisoId = premisosRol[x].rolPermisoId;\n            }\n\n            ;\n          }\n\n          let nuevoRolPermisoTable = {\n            rolpermisoId: rolPermisoId || 0,\n            check: check,\n            rolid: _this.idrol,\n            permisoid: _this.Permisos[i].permisoId,\n            Nombre: _this.Permisos[i].nombre,\n            descripcion: _this.Permisos[i].descripcion\n          };\n\n          _this.rolPermisosTable.push(nuevoRolPermisoTable);\n        }\n      })();\n    }\n\n    cargarLista() {\n      var _this2 = this;\n\n      return _asyncToGenerator(function* () {\n        _this2.loginServices.GetAllData('Permisos').subscribe(respuesta => {\n          _this2.Permisos = respuesta.data;\n        });\n\n        _this2.loginServices.GetAllData('Roles').subscribe(respuesta => {\n          _this2.roles = respuesta.data;\n        });\n\n        yield _this2.cargarRolesPermisos();\n      })();\n    }\n\n    cargarRolesPermisos() {\n      this.loginServices.GetAllData('rolesPermisos').subscribe(respuesta => {\n        this.rolesPermisos = respuesta.data;\n      });\n    }\n\n  }\n\n  PermisosComponent.ɵfac = function PermisosComponent_Factory(t) {\n    return new (t || PermisosComponent)(i0.ɵɵdirectiveInject(i1.FormBuilder), i0.ɵɵdirectiveInject(i2.NgbModal), i0.ɵɵdirectiveInject(i3.Router), i0.ɵɵdirectiveInject(i4.loginTiinduxService));\n  };\n\n  PermisosComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: PermisosComponent,\n    selectors: [[\"app-permisos\"]],\n    decls: 20,\n    vars: 4,\n    consts: [[1, \"container\"], [\"autocomplete\", \"off\", 1, \"container\", 3, \"formGroup\"], [\"for\", \"rolId\"], [\"formControlName\", \"rolId\", 3, \"change\"], [\"value\", \"0\"], [3, \"value\", 4, \"ngFor\", \"ngForOf\"], [\"class\", \"container\", 4, \"ngIf\"], [\"class\", \"canva\", 4, \"ngIf\"], [3, \"value\"], [4, \"ngFor\", \"ngForOf\"], [\"aria-label\", \"page\", 1, \"m-3\", 3, \"length\", \"pageSize\", \"pageSizeOptions\", \"page\"], [\"type\", \"checkbox\", 3, \"checked\", \"change\"], [2, \"text-align\", \"center\"], [1, \"canva\"], [\"src\", \"../../../assets/load.gif\", \"alt\", \"Cargando\"]],\n    template: function PermisosComponent_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵelement(0, \"app-navigation\");\n        i0.ɵɵelementStart(1, \"div\", 0);\n        i0.ɵɵelement(2, \"br\");\n        i0.ɵɵelement(3, \"br\");\n        i0.ɵɵelement(4, \"br\");\n        i0.ɵɵelementStart(5, \"form\", 1);\n        i0.ɵɵelementStart(6, \"h3\");\n        i0.ɵɵtext(7, \"Asignaci\\u00F3n de permisos a roles:\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelement(8, \"hr\");\n        i0.ɵɵelementStart(9, \"label\", 2);\n        i0.ɵɵtext(10, \"Seleccione un rol: * \");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(11, \"select\", 3);\n        i0.ɵɵlistener(\"change\", function PermisosComponent_Template_select_change_11_listener($event) {\n          return ctx.rolSelect($event);\n        });\n        i0.ɵɵelementStart(12, \"option\", 4);\n        i0.ɵɵtext(13, \"--Seleccione una opcion--\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵtemplate(14, PermisosComponent_option_14_Template, 2, 2, \"option\", 5);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelement(15, \"br\");\n        i0.ɵɵelement(16, \"br\");\n        i0.ɵɵelement(17, \"br\");\n        i0.ɵɵtemplate(18, PermisosComponent_div_18_Template, 14, 4, \"div\", 6);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵtemplate(19, PermisosComponent_div_19_Template, 2, 0, \"div\", 7);\n      }\n\n      if (rf & 2) {\n        i0.ɵɵadvance(5);\n        i0.ɵɵproperty(\"formGroup\", ctx.PermisosForm);\n        i0.ɵɵadvance(9);\n        i0.ɵɵproperty(\"ngForOf\", ctx.roles);\n        i0.ɵɵadvance(4);\n        i0.ɵɵproperty(\"ngIf\", ctx.rolSeleccionado);\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngIf\", ctx.canva);\n      }\n    },\n    directives: [i5.NavigationComponent, i1.ɵNgNoValidate, i1.NgControlStatusGroup, i1.FormGroupDirective, i1.SelectControlValueAccessor, i1.NgControlStatus, i1.FormControlName, i1.NgSelectOption, i1.ɵNgSelectMultipleOption, i6.NgForOf, i6.NgIf, i7.MatPaginator],\n    styles: [\"@charset \\\"UTF-8\\\";label[_ngcontent-%COMP%]{color:#333;font-size:16px;font-weight:bold}.on[_ngcontent-%COMP%]{background-color:green;color:#fff}.off[_ngcontent-%COMP%]{background-color:red;color:#fff}.switch[_ngcontent-%COMP%]{position:relative;display:inline-block;width:60px;height:34px}.switch[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{opacity:0;width:0;height:0}.slider[_ngcontent-%COMP%]{position:absolute;cursor:pointer;top:0;left:0;right:0;bottom:0;background-color:#ccc;border-radius:34px;transition:.4s}.slider[_ngcontent-%COMP%]:before{position:absolute;content:\\\"\\\";height:26px;width:26px;left:4px;bottom:4px;background-color:#fff;border-radius:50%;transition:.4s}input[_ngcontent-%COMP%]:checked + .slider[_ngcontent-%COMP%]{background-color:#2196f3}input[_ngcontent-%COMP%]:checked + .slider[_ngcontent-%COMP%]:before{transform:translate(26px)}\"]\n  });\n  return PermisosComponent;\n})();","map":null,"metadata":{},"sourceType":"module"}